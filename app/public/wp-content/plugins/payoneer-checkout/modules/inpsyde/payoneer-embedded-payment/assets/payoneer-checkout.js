!function(){"use strict";var e={20:function(e,t,n){var o=n(609),a=Symbol.for("react.element"),s=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),r=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};t.jsx=function(e,t,n){var o,i={},d=null,l=null;for(o in void 0!==n&&(d=""+n),void 0!==t.key&&(d=""+t.key),void 0!==t.ref&&(l=t.ref),t)s.call(t,o)&&!c.hasOwnProperty(o)&&(i[o]=t[o]);if(e&&e.defaultProps)for(o in t=e.defaultProps)void 0===i[o]&&(i[o]=t[o]);return{$$typeof:a,type:e,key:d,ref:l,props:i,_owner:r.current}}},609:function(e){e.exports=window.React},848:function(e,t,n){e.exports=n(20)}},t={};function n(o){var a=t[o];if(void 0!==a)return a.exports;var s=t[o]={exports:{}};return e[o](s,s.exports,n),s.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};n.r(o),n.d(o,{addComponentToContainer:function(){return M},initPayoneerComponents:function(){return F},mountComponents:function(){return B},onBeforeError:function(){return T},onComponentListChange:function(){return A},onPaymentDeclined:function(){return C},onValidationInfo:function(){return D},pay:function(){return v},reboot:function(){return V},registerComponent:function(){return L},releaseOnHoldOrder:function(){return N},removeComponentFromContainer:function(){return R},setActivePaymentMethod:function(){return I},setEnv:function(){return w},setForceHostedFlow:function(){return P},setIsMounted:function(){return j},setIsReady:function(){return K},setIsValid:function(){return Y},setLongId:function(){return k},setOnPaymentDeclinedNonce:function(){return b},setOrderId:function(){return O},setSdkState:function(){return f},unmountAllComponents:function(){return U},unregisterComponent:function(){return H}});var a={};n.r(a),n.d(a,{getEnv:function(){return Q},getExtensionData:function(){return q},getLongId:function(){return z},getSdk:function(){return X},getSdkIntegrity:function(){return J},getSdkVersion:function(){return Z}});var s=window.jQuery,r=n.n(s);const{paymentFieldsComponentAttribute:c}=window.PayoneerData,i=()=>document.querySelector('.woocommerce-checkout input[name="payment_method"]:checked'),d=()=>{return t=null!==(e=i()?.id)&&void 0!==e?e:"",/^payment_method_payoneer-(checkout|afterpay|klarna|affirm|bancontact|eps|ideal|multibanco|p24)/i.test(t);var e,t},l=()=>"1"===window.PayoneerData.isPayForOrder,p=()=>{i()?.focus()};var u=window.wp.data;const y={SET_EXTENSION_DATA:"SET_EXTENSION_DATA",SET_LONG_ID:"SET_LONG_ID",SET_LIST_URL:"SET_LIST_URL",SET_ENV:"SET_ENV",SET_SDK:"SET_SDK",SET_SDK_VERSION:"SET_SDK_VERSION",SET_SDK_INTEGRITY:"SET_SDK_INTEGRITY",SET_SDK_STATE:"SET_SDK_STATE",PAY:"PAY",SET_ACTIVE_PAYMENT_METHOD:"SET_ACTIVE_PAYMENT_METHOD",SET_FORCE_HOSTED_FLOW:"SET_FORCE_HOSTED_FLOW",SET_ORDER_ID:"SET_ORDER_ID",SET_ON_PAYMENT_DECLINED_NONCE:"SET_ON_PAYMENT_DECLINED_NONCE",ADD_COMPONENT:"ADD_COMPONENT",REMOVE_COMPONENT:"REMOVE_COMPONENT",SET_IS_VALID:"SET_IS_VALID",SET_IS_MOUNTED:"SET_IS_MOUNTED",SET_IS_READY:"SET_IS_READY",MOUNT_COMPONENTS:"MOUNT_COMPONENTS"},m={activePaymentMethod:"",longId:null,env:null,sdkState:"UNINITIALIZED",forceHostedFlow:!0,components:{}},h=(e,t,n)=>{const o=e.components[t]||{};return{...e.components,[t]:{key:t,instance:o.instance||null,isMounted:o.isMounted||!1,isReady:o.isReady||!1,isValid:o.isValid||!1,...n}}};var S=window.wp.hooks;const{paymentFieldsComponentAttribute:g}=window.PayoneerData,E=e=>({"payoneer-checkout":"cards","payoneer-afterpay":"afterpay","payoneer-klarna":"klarna","payoneer-affirm":"affirm","payoneer-bancontact":"bancontact","payoneer-eps":"eps","payoneer-ideal":"ideal","payoneer-multibanco":"multibanco","payoneer-p24":"p24"}[e]),_=(...e)=>console.log("[action]",...e),k=e=>async({select:t,resolveSelect:n,dispatch:o})=>{const a=await n.getSdk();await a.updateLongId(e),o({type:y.SET_LONG_ID,payload:e})},f=e=>({type:y.SET_SDK_STATE,payload:e});function w(e){return{type:y.SET_ENV,payload:e}}const v=()=>({select:e,dispatch:t})=>{const{instance:n}=e.getActiveComponent();n?n.pay?(_("pay -",n),n.pay()):_("Component does not have a pay method.",n):_("Component not found.")},T=(e,t,n)=>async({select:o,dispatch:a})=>(console.error("callback: onBeforeError -",{sdk:e,component:t,data:n}),a.setSdkState(e.state),["SYSTEM_FAILURE"].includes(n?.interaction?.reason)?(a.setForceHostedFlow(!0),!0):S.defaultHooks.applyFilters("payoneer.webSdk.onSdkError",!1,e,t,n)),C=(e,t,n)=>async({select:o,dispatch:a})=>(_("callback: onPaymentDeclined -",t,n),S.defaultHooks.applyFilters("payoneer.webSdk.onPaymentDeclined",!0,e,t,n)),D=(e,t,n)=>async({select:e,dispatch:o})=>{_("callback: onValidationInfo -",t,n);const a=((e,t)=>{var n;return"card"===(e=null!==(n=t.methodName)&&void 0!==n?n:e)?"cards":e})(t,n);o.setIsValid(a,n.valid),o.setIsReady(a,!0)},I=e=>async({dispatch:t})=>{_("setActivePaymentMethod -",e),t.mountComponents(),t({type:y.SET_ACTIVE_PAYMENT_METHOD,payload:e})};function P(e){return _("setForceHostedFlow - override state:",e),{type:y.SET_FORCE_HOSTED_FLOW,payload:e}}const b=e=>({dispatch:t})=>{t({type:y.SET_ON_PAYMENT_DECLINED_NONCE,payload:e})},O=e=>({dispatch:t})=>{t({type:y.SET_ORDER_ID,payload:e})},N=e=>async({dispatch:t})=>{_("releaseOnHoldOrder -",e);const n=window.wc_checkout_params.wc_ajax_url.toString().replace("%%endpoint%%","payoneer-checkout-payment-declined"),o=n.includes("?")?"&":"?",a=n+o+"_ajax_nonce="+window.PayoneerData.onPaymentDeclinedNonce;return new Promise((n,o)=>{r().ajax({type:"POST",url:a,xhrFields:{withCredentials:!0},data:e,dataType:"json"}).success(e=>{t.setOnPaymentDeclinedNonce(e.nonce),n(e)}).catch(e=>{console.error(e),o(e)})})},A=(e,t)=>async({select:n,dispatch:o})=>{_("callback: onComponentListChange",e,t),t.addedComponents.forEach(e=>{o.addComponentToContainer(e)}),t.removedComponents.forEach(e=>{o.removeComponentFromContainer(e)})},M=e=>async({select:t,resolveSelect:n,dispatch:o})=>{const a=await n.getSdk();if(!a.isDroppedIn(e))try{const t=a.dropIn(e,{hidePaymentButton:!0});o.registerComponent(e,t)}catch(t){console.error(`Failed to drop in component ${e}. Error details: ${t}`)}const{instance:s}=t.getComponentByName(e);x(e,s,a,o)},R=e=>async({select:t,resolveSelect:n,dispatch:o})=>{o.unregisterComponent(e)},L=(e,t)=>({type:y.ADD_COMPONENT,payload:{componentName:e,instance:t}}),H=e=>({type:y.REMOVE_COMPONENT,payload:{componentName:e}}),F=()=>async({select:e,resolveSelect:t,dispatch:n})=>{_("initPayoneerComponents");const o=await t.getSdk(),a=await t.getLongId();await o.updateLongId(a),await n.mountComponents()},V=()=>async({select:e,resolveSelect:t,dispatch:n})=>{_("reboot"),n.unmountAllComponents(),S.defaultHooks.doAction("payoneer.webSdk.reboot"),wp.data.dispatch("wc/store/cart").invalidateResolutionForStore(),n.invalidateResolutionForStore(),await n.mountComponents()},B=()=>async({select:e,resolveSelect:t,dispatch:n})=>{_("mountComponents"),n.unmountAllComponents();const o=await t.getSdk(),a=e.getAllComponents();Object.entries(a).forEach(async([e,t])=>{x(e,t.instance,o,n)})},x=(e,t,n,o)=>{((e,t,n)=>{if(!t||!n.isAvailable(e))return;const o=function(e){return document.querySelector(`[${g}=${e}]`)}(e);o instanceof Element&&(console.log("mountSdkComponent:",e,t),t.mount(o))})(e,t,n),o.setIsMounted(e,!0),(e=>e.element instanceof Element&&e.element.id.includes("redirect"))(t)&&(_("mark redirect component as valid and ready -",e),o.setIsReady(e,!0),o.setIsValid(e,!0))},U=()=>({select:e,dispatch:t})=>{const n=e.getAllComponents();Object.keys(n).forEach(e=>{t.setIsMounted(e,!1)})},Y=(e,t)=>({type:y.SET_IS_VALID,payload:{componentName:e,flag:t}}),j=(e,t=!0)=>({type:y.SET_IS_MOUNTED,payload:{componentName:e,flag:t}}),K=(e,t)=>({type:y.SET_IS_READY,payload:{componentName:e,flag:t}});var G=window.wp.apiFetch,$=n.n(G);const{websdkStyles:W}=PayoneerData,X=()=>async({resolveSelect:e,dispatch:t})=>{const n=await e.getEnv(),o=await e.getSdkVersion(),a=await e.getSdkIntegrity(),s=await e.getLongId(),r=await(c={env:n,sdkVersion:o,sdkIntegrity:a,onBeforeError:async(e,n,o)=>await t.onBeforeError(e,n,o),onPaymentDeclined:async(e,n,o)=>await t.onPaymentDeclined(e,n,o),onComponentListChange:async(e,n)=>await t.onComponentListChange(e,n),onValidationInfo:async(e,n,o)=>await t.onValidationInfo(e,n,o),preload:["stripe:cards"],styles:W,refetchListBeforeCharge:!0},window.Payoneer?.CheckoutWeb?window.Payoneer.CheckoutWeb(c):new Promise((e,t)=>{const n=document.createElement("script");n.src=((e,t)=>{const n=t?`-${t}`:"";return new URL(window.PayoneerData.webSdkUmdUrlTemplate?.replace("<env>",e)?.replace("<version>",n))})(c.env,c.sdkVersion),n.onload=e,n.onerror=t,c.sdkVersion&&c.sdkIntegrity&&(n.integrity=c.sdkIntegrity,n.crossOrigin="anonymous"),document.head.appendChild(n)}).then(()=>window.Payoneer.CheckoutWeb(c)));var c;if("LOADING"===r.state){const e=async()=>await new Promise(e=>{const t=setInterval(()=>{"LOADING"!==r.state&&(e(r.state),clearInterval(t))},1e3)});await e()}await r.updateLongId(s),await t.setForceHostedFlow(!1),await t.setSdkState(r.state),await t({type:y.SET_SDK,payload:r})},q=()=>async({dispatch:e})=>{const t=await $()({path:"/wc/store/v1/cart#skipPreloadingMiddleware",method:"GET",cache:"no-store",parse:!1}),n=(await t.json()).extensions["payoneer-checkout"];console.log("Payoneer Extension Data: ",n),await e({type:y.SET_EXTENSION_DATA,payload:n}),S.defaultHooks.doAction("payoneer.checkout.onReceiveExtensionData",n)},z=()=>async({resolveSelect:e,dispatch:t})=>{const n=await e.getExtensionData();await t({type:y.SET_LONG_ID,payload:n.longId})},Q=()=>async({resolveSelect:e,dispatch:t})=>{const n=await e.getExtensionData();await t({type:y.SET_ENV,payload:n.environment})},Z=()=>async({resolveSelect:e,dispatch:t})=>{const n=await e.getExtensionData();await t({type:y.SET_SDK_VERSION,payload:n.sdkVersion})},J=()=>async({resolveSelect:e,dispatch:t})=>{const n=await e.getExtensionData();await t({type:y.SET_SDK_INTEGRITY,payload:n.sdkIntegrity})};var ee={getExtensionData:e=>e.extension,getLongId:e=>e.longId,getEnv:e=>e.env,getSdkVersion:e=>e.sdkVersion,getSdkIntegrity:e=>e.sdkIntegrity,getSdk:e=>e.sdk,isHostedModeForced:e=>e.forceHostedFlow,getActivePaymentMethod:e=>e.activePaymentMethod,getOrderId:e=>e.orderId,getOnPaymentDeclinedNonce:e=>e.onPaymentDeclinedNonce,getAllComponents:e=>e.components,getComponentByName:(e,t)=>{var n;return null!==(n=e.components[t])&&void 0!==n?n:{}},getActiveComponent:e=>{var t;const n=E(e.activePaymentMethod);return null!==(t=e.components[n])&&void 0!==t?t:{}}};const te="payoneer-checkout",ne=(0,u.createReduxStore)(te,{reducer:(e=m,{type:t,payload:n})=>{switch(t){case y.SET_EXTENSION_DATA:return{...e,extension:n};case y.SET_LONG_ID:return{...e,longId:n};case y.SET_LIST_URL:return{...e,listUrl:n};case y.SET_ENV:return{...e,env:n};case y.SET_SDK:return{...e,sdk:n};case y.SET_SDK_VERSION:return{...e,sdkVersion:n};case y.SET_SDK_INTEGRITY:return{...e,sdkIntegrity:n};case y.SET_SDK_STATE:return{...e,sdkState:n};case y.SET_ACTIVE_PAYMENT_METHOD:return{...e,activePaymentMethod:n};case y.SET_FORCE_HOSTED_FLOW:return{...e,forceHostedFlow:n};case y.SET_ORDER_ID:return{...e,orderId:n};case y.SET_ON_PAYMENT_DECLINED_NONCE:return{...e,onPaymentDeclinedNonce:n};case y.ADD_COMPONENT:return{...e,components:h(e,n.componentName,{instance:n.instance})};case y.REMOVE_COMPONENT:{const{[n.componentName]:t,...o}=e.components;return{...e,components:o}}case y.SET_IS_VALID:return{...e,components:h(e,n.componentName,{isValid:n.flag})};case y.SET_IS_MOUNTED:return{...e,components:h(e,n.componentName,{isMounted:n.flag})};case y.SET_IS_READY:return{...e,components:h(e,n.componentName,{isReady:n.flag})};default:return e}},actions:o,selectors:ee,resolvers:a});(0,u.register)(ne);const oe="x-payoneer-checkout-force-hosted-flow",ae="x-payoneer-is-payment-checkout",se=()=>{const e={[oe]:String((0,u.select)(te).isHostedModeForced()),[ae]:l&&new URLSearchParams(window.location.search).get("key")||""};return S.defaultHooks.applyFilters("payoneer.http.customHeaders",e)};S.defaultHooks.addAction("payoneer.checkout.onReceiveExtensionData","payoneer/setupCustomHttpHeaders",()=>{S.defaultHooks.addFilter("payoneer.http.customHeaders","payoneer/setupCustomHttpHeaders",function(e){return e["x-payoneer-long-id"]=String((0,u.select)(te).getLongId()),e})});var re=window.wc.wcBlocksData;const ce=()=>{const e=function(){const e=null!==(t=i()?.value)&&void 0!==t?t:"";var t;(0,u.dispatch)(te).setActivePaymentMethod(e)};jQuery(document.body).on("payment_method_selected",e),e(),ie()},ie=()=>{const e=["key","isValid","isMounted","isReady"],t=(0,u.select)(te),n={};let o=null;const a=(...e)=>console.log("[componentObserver]",...e),s=r=>{const c=(()=>{const o=t.getActiveComponent();return a=o,!!e.some(e=>n[e]!==a[e])&&((t=>{e.forEach(e=>n[e]=t[e])})(o),!0);var a})();(c||0!==r)&&(c&&r<10?o=setTimeout(s,25,r+1):(a("active payment component changed -",n),S.defaultHooks.doAction("payoneer.checkout.paymentMethodChanged",{...n}),o=null))};return a("subscribe to store changes"),e.forEach(e=>n[e]=null),{unsubscribe:(0,u.subscribe)(()=>{null===o&&s(0)},te)}},de="payoneer-checkout-payment-allowed",le="payoneer-checkout-payment-data-invalid",pe="payoneer-checkout-payment-not-ready";var ue=class{#e="";#t=null;#n=null;#o={active:!0,processing:!1,valid:!1};constructor(e=".form-row.place-order"){this.#e=e,this.#a("initialized"),this.#s()}get area(){return r()(this.#e)}get button(){return this.area.find("#place_order")}get isPaymentAllowed(){const{active:e,valid:t,processing:n}=this.#o;return!e||t&&!n}get isAreaBlocked(){return!!this.area.data("blockUI.isBlocked")}get isButtonDisabled(){return this.button.prop("disabled")}get validPaymentInput(){return this.#o.valid}setValidInput(e){this.#o.valid=e,this.#s()}setProcessing(e=!0){e?this.#o.processing=!0:(this.#n=null,this.#o.processing=!1),this.#s()}setProcessingMessage(e){this.#n=e,this.#s()}setActive(e){this.#o.active=e,this.#s()}#s(){const{active:e,valid:t,processing:n}=this.#o;return e?n?(this.#r(pe),void this.#c()):(this.#i(),void(t?(this.#r(de),this.#d()):(this.#r(le),this.#l()))):(this.#i(),this.#d(),void this.#r(null))}#r(e){const t=[de,le,pe];t.forEach(e=>{document.body.classList.remove(e)}),e&&t.includes(e)&&document.body.classList.add(e)}#c(){if("function"!=typeof r().fn.block)return;const e={message:this.#n,overlayCSS:{background:"#fff",opacity:.6}};this.#n&&(e.blockMsgClass="no-spinner",e.css={maxWidth:"80%",width:"auto",cursor:"default"}),this.isAreaBlocked&&(e.fadeIn=0),this.#p(),this.area.block(e),this.#a("ðŸ”’ area blocked (spinner)")}#i(){this.isAreaBlocked&&"function"==typeof r().fn.unblock&&(this.#u(),this.area.unblock(),this.#a("ðŸ”“ area unblocked"))}#l(){this.isButtonDisabled||(this.button.prop("disabled",!0).addClass("disabled"),this.#a("âŒ button disabled"))}#d(){this.isButtonDisabled&&(this.button.prop("disabled",!1).removeClass("disabled"),this.#a("âœ… button enabled"))}#p(){this.#t||(this.#t=document.createElement("style"),this.#t.textContent=this.#y(),document.head.appendChild(this.#t),this.#a("ðŸŽ¨ blocking CSS injected"))}#u(){this.#t&&(this.#t.remove(),this.#t=null,this.#a("ðŸŽ¨ blocking CSS removed"))}#y(){const e=this.#e;return`\n\t\t\t${e} .place-order {\n\t\t\t\tpointer-events: none !important;\n\t\t\t}\n\t\t\t${e} #place_order {\n\t\t\t\topacity: 0.5 !important;\n\t\t\t\tpointer-events: none !important;\n\t\t\t}\n\t\t\t.blockUI.no-spinner:before {\n\t\t\t\tdisplay: none !important;\n\t\t\t}\n\t\t\t.blockUI.no-spinner button {\n\t\t\t\tdisplay: block;\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t`}#a(e){const{active:t,valid:n,processing:o}=this.#o;console.log(`[OrderPlacement] ${e} | A:${t} V:${n} P:${o}`)}};const ye=(...e)=>console.log("[classic checkout]",...e),me=()=>(0,u.dispatch)(te).releaseOnHoldOrder(),he=(0,u.select)(te);var Se=n(609),ge=n(848);const Ee=()=>(0,u.dispatch)(te).initPayoneerComponents(),_e=()=>(0,u.dispatch)(te).pay(),ke=()=>(0,u.dispatch)(te).reboot(),fe=(0,u.withSelect)((e,t)=>{const n=e(te),{activePaymentMethod:o,eventRegistration:a}=t,s=E(o),{isValid:r,isReady:c}=n.getComponentByName(s);return{activePaymentMethod:o,eventRegistration:a,canMakePayment:c&&r,componentName:s,initPayoneerComponents:Ee,rebootPayoneer:ke,payWithPayoneer:_e}})(function({activePaymentMethod:e,eventRegistration:t,componentName:n,paymentMethodData:o,canMakePayment:a,initPayoneerComponents:s,rebootPayoneer:r,payWithPayoneer:c}){const{onPaymentSetup:i,onCheckoutSuccess:d,onCheckoutFail:l}=t;return(0,Se.useEffect)(()=>{s()},[]),(0,Se.useEffect)(()=>d(({orderId:e})=>{(0,u.dispatch)(te).setOrderId(e),c()}),[]),(0,Se.useEffect)(()=>l(r),[]),(0,Se.useEffect)(()=>i(()=>a?{type:"success"}:{type:"failure",message:"Invalid payment fields"}),[a,i,o]),(0,ge.jsx)("div",{className:`payment_method_${e}`,"data-component":n})}),we=(0,u.select)(te),ve=(...e)=>console.log("[payment page]",...e),Te=()=>(0,u.dispatch)(te).releaseOnHoldOrder(),Ce=(0,u.select)(te);document.addEventListener("DOMContentLoaded",async()=>{const e=window.fetch;if(window.fetch=async(...t)=>{let[n,o]=t;if(new URL(n,window.location.origin).origin!==window.location.origin)return e(n,o);const a=se();return console.log("Adding custom headers to fetch call",a),o=o&&o.headers?{...o,headers:{...o.headers,...a}}:{...o,headers:a},await e(n,o)},!window.XMLHttpRequest)return;const t=XMLHttpRequest.prototype.open,n=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.open=function(e,n,...o){this._isSameOrigin=new URL(n,window.location.origin).origin===window.location.origin,t.apply(this,[e,n,...o])},XMLHttpRequest.prototype.send=function(...e){const t=se();if(this._isSameOrigin){console.log("Adding custom headers to XMLHttpRequest call",t);for(const[e,n]of Object.entries(t))this.setRequestHeader(e,n)}n.apply(this,e)}},!1),l()?(()=>{ve("init");const e=new ue("#payment .form-row");S.defaultHooks.addAction("payoneer.checkout.paymentMethodChanged","payoneer/shortcodeCheckout",({key:t,isValid:n,isReady:o})=>{ve("hook paymentMethodChanged"),t||d()?(e.setActive(!0),e.setProcessing(!o),e.setValidInput(n)):e.setActive(!1)});const t=r()('<button type="button" />').text("Cancel Payment").on("click",()=>{e.setProcessingMessage(null),Te(Ce.getLongId()).then(()=>window.location.reload())});document.addEventListener("DOMContentLoaded",()=>{ve("dom ready, setup listeners"),ce(),PayoneerData.onPaymentDeclinedNonce,(0,u.dispatch)(te).setOnPaymentDeclinedNonce();const n=r()("#order_review");S.defaultHooks.addFilter("payoneer.webSdk.onSdkError","payoneer/paymentCheckout",(e,t,n,o)=>{ve("hook onSdkError",{isResolved:e,data:o});const{payOrderErrorFlag:a}=window.PayoneerData,s=new URL(document.location);return s.searchParams.set(a,!0),window.location.href=s.toString(),e}),S.defaultHooks.addFilter("payoneer.webSdk.onPaymentDeclined","payoneer/paymentCheckout",async()=>(ve("hook onPaymentDeclined"),await Te((Ce.getLongId(),new URLSearchParams(window.location.search).get("key"))),window.location.reload(),!1)),n.on("submit",o=>{if(ve("event submit"),!d()||Ce.isHostedModeForced())return;o.preventDefault(),o.stopImmediatePropagation();const{isValid:a,isReady:s,key:c}=Ce.getActiveComponent();var i;if(s&&a)e.setProcessing(!0),(i=n,i.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),r().ajax({type:"POST",url:window.wc_checkout_params.ajax_url,xhrFields:{withCredentials:!0},dataType:"json",data:{action:"payoneer_order_pay",fields:i.serialize(),params:new URL(document.location).searchParams.toString()}}).always(()=>i.unblock())).then(()=>{(0,u.dispatch)(te).pay(),(n=>{if("cards"===n)return;let o=!1;try{o=localStorage.getItem("testCancelButton")}catch(e){}o&&(setTimeout(()=>e.setProcessingMessage(t),2e3),setTimeout(()=>e.setProcessingMessage(null),57e3))})(c)}).catch(()=>{window.scrollTo(0,0),window.location.reload()});else try{p()}catch(e){console.error(e)}}),(0,u.dispatch)(te).mountComponents()},!1)})():"1"===window?.PayoneerData?.isBlockCheckout?(console.log("Loading block checkout integration"),(()=>{let e;const t=(0,u.select)(re.PAYMENT_STORE_KEY),n=()=>{const n=t.getActivePaymentMethod();e!==n&&((0,u.dispatch)(te).setActivePaymentMethod(n),e=n)};(0,u.subscribe)(n,re.PAYMENT_STORE_KEY),n()})(),Array.isArray(inpsydeGateways)?inpsydeGateways.forEach(e=>{var t;t=e,wp.hooks.addFilter(`${t}_checkout_fields`,t,e=>(e.push(fe),e)),wp.hooks.addFilter("payoneer-checkout_payment_method_icons","payoneer-checkout",e=>"payoneer-checkout"===we.getActivePaymentMethod()?[]:e)}):console.error("window.inpsydeGateways not found"),document.addEventListener("DOMContentLoaded",()=>{wp.hooks.addFilter("payoneer.webSdk.onPaymentDeclined","payoneer/blockCheckout",()=>(wp.data.dispatch(te).releaseOnHoldOrder({longId:(0,u.select)(te).getLongId(),payoneerOrderId:(0,u.select)(te).getOrderId()}),window.location.reload(),!0))},!1)):(()=>{ye("init");const e=new ue("#payment");S.defaultHooks.addAction("payoneer.checkout.paymentMethodChanged","payoneer/shortcodeCheckout",({key:t,isValid:n,isReady:o})=>{ye("hook paymentMethodChanged"),t||d()?(e.setActive(!0),e.setProcessing(!o),e.setValidInput(n)):e.setActive(!1)});const t=r()('<button type="button" />').text("Cancel Payment").on("click",()=>{e.setProcessingMessage(null),me(he.getLongId()).then(()=>window.location.reload())});document.addEventListener("DOMContentLoaded",()=>{ye("dom ready, setup listeners"),ce(),PayoneerData.onPaymentDeclinedNonce,(0,u.dispatch)(te).setOnPaymentDeclinedNonce();const n=r()("form.checkout");S.defaultHooks.addFilter("payoneer.webSdk.onSdkError","payoneer/shortcodeCheckout",(e,t,n,o)=>(ye("hook onSdkError",{isResolved:e,data:o}),(0,u.dispatch)(te).reboot(),r()(document.body).trigger("update_checkout"),e)),S.defaultHooks.addFilter("payoneer.webSdk.onPaymentDeclined","payoneer/shortcodeCheckout",()=>(ye("hook onPaymentDeclined"),me(he.getLongId()).finally(()=>{e.setProcessing(!1)}),r()(document.body).trigger("update_checkout"),!0)),r()(document.body).on("updated_checkout",()=>{ye("event updated_checkout"),(0,u.dispatch)(te).initPayoneerComponents()}),n.on("checkout_place_order",t=>{if(ye("event checkout_place_order"),!d()||he.isHostedModeForced())return;if(!e.isPaymentAllowed)return t.preventDefault(),t.stopImmediatePropagation(),ye("checkout submission prevented - payment not allowed in current state"),!1;const{isValid:n,isReady:o}=he.getActiveComponent();if(!o||!n){try{p()}catch(e){console.error(e)}return!1}return e.setProcessing(!0),!0}),n.on("checkout_place_order_success",(n,o)=>{if(ye("event checkout_place_order_success"),!d()||he.isHostedModeForced())return;const{key:a}=he.getActiveComponent();return(0,u.dispatch)(te).pay(),(n=>{if("cards"===n)return;let o=!1;try{o=localStorage.getItem("testCancelButton")}catch(e){}o&&(setTimeout(()=>e.setProcessingMessage(t),2e3),setTimeout(()=>e.setProcessingMessage(null),57e3))})(a),o.redirect="#payoneer-redirect",!1}),r()(document.body).on("checkout_error",(t,n)=>{n&&n.includes('data-payment-state="pending"')||(ye("event checkout_error"),e.setProcessing(!1))})},!1)})()}();
//# sourceMappingURL=payoneer-checkout.js.map